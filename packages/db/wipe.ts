import { unlinkSync, existsSync } from 'fs';
import { join } from 'path';

const envDbUrl = process.env.DATABASE_URL;

if (!envDbUrl) {
    throw new Error('DATABASE_URL environment variable is not set. Cannot wipe unknown database.');
}

// Basic handling for "file:" protocol
let dbPath = envDbUrl.replace('file:', '');

console.log(`üóëÔ∏è  Wiping database at: ${dbPath}`);

try {
    if (existsSync(dbPath)) {
        unlinkSync(dbPath);
        console.log('‚úÖ Main database file deleted.');
    } else {
        console.log('‚ö†Ô∏è  Main database file not found.');
    }

    // Clean up WAL/SHM files if they exist
    const shmPath = `${dbPath}-shm`;
    const walPath = `${dbPath}-wal`;

    if (existsSync(shmPath)) {
        unlinkSync(shmPath);
        console.log('‚úÖ SHM file deleted.');
    }

    if (existsSync(walPath)) {
        unlinkSync(walPath);
        console.log('‚úÖ WAL file deleted.');
    }

    console.log('\n‚ú® Wipe complete!');

} catch (error) {
    console.error('‚ùå Failed to wipe database:', error);
    process.exit(1);
}
